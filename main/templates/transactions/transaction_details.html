{% extends "base.html" %}
{% load static %}
{% load humanize %}

{% block title %}Transactions - {{ block.super }}{% endblock %}

{% block header %}Transaction Details{% endblock %}

{% block content %}
<div class="space-y-6" x-data="{
    showCopied: false,
    copyToClipboard(text) {
        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(text).then(() => {
                this.showCopied = true;
                setTimeout(() => { this.showCopied = false }, 2000);
            }).catch(err => console.error('Failed to copy: ', err));
        } else {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                document.execCommand('copy');
                this.showCopied = true;
                setTimeout(() => { this.showCopied = false }, 2000);
            } catch (err) {
                console.error('Fallback: Oops, unable to copy', err);
            }
            document.body.removeChild(textArea);
        }
    }
}">
    <!-- Back Button -->
    <div>
        <a href="{% url 'transactions' %}" class="inline-flex items-center px-4 py-2 rounded-xl text-gecu-navy hover:bg-gecu-light font-medium transition-all duration-200 group">
            <i class="fas fa-arrow-left mr-2 transform group-hover:-translate-x-1 transition-transform"></i> 
            Back to Transactions
        </a>
    </div>

    <!-- Transaction Header Card -->
    <div class="glass-effect rounded-2xl shadow-xl overflow-hidden">
        <!-- Hero Section with Gradient -->
        <div class="bg-gradient-to-r from-gecu-navy to-gecu-blue px-6 py-8 text-white">
            <div class="flex items-start justify-between mb-4">
                <div class="flex items-center space-x-4">
                    <div class="w-16 h-16 rounded-2xl bg-white/20 backdrop-blur-sm flex items-center justify-center">
                        <i class="fas {% if is_credit %}fa-arrow-up{% else %}fa-arrow-down{% endif %} text-3xl"></i>
                    </div>
                    <div>
                        <h3 class="text-2xl font-bold mb-1">
                            {{ transaction.description|default:"Transaction" }}
                        </h3>
                        <div class="flex items-center text-sm opacity-90">
                            <span id="transactionId" class="font-mono">{{ transaction.reference_code }}</span>
                            <button @click="copyToClipboard(document.getElementById('transactionId').innerText)" 
                                    title="Copy Reference"
                                    class="ml-2 hover:bg-white/20 p-1.5 rounded-lg transition-all">
                                <i class="far fa-copy"></i>
                            </button>
                            <span x-show="showCopied" 
                                  x-transition 
                                  class="ml-2 bg-green-500 text-white text-xs px-2 py-1 rounded-full font-medium">
                                Copied!
                            </span>
                        </div>
                    </div>
                </div>
                <span class="px-4 py-2 bg-white/20 backdrop-blur-sm rounded-xl text-sm font-semibold flex items-center">
                    <i class="fas fa-check-circle mr-2"></i>Completed
                </span>
            </div>
            
            <!-- Amount Display -->
            <div class="mt-6 text-center py-4">
                <p class="text-sm opacity-75 mb-2">Amount</p>
                <p class="text-5xl font-bold tracking-tight">
                    {% if is_credit %}+{% else %}-{% endif %}${{ transaction.amount|intcomma }}
                </p>
            </div>
        </div>

        <!-- Transaction Details -->
        <div class="px-6 py-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Date & Time -->
                <div class="bg-gecu-light/50 rounded-xl p-4">
                    <div class="flex items-center mb-2">
                        <div class="w-8 h-8 rounded-lg bg-white flex items-center justify-center mr-3">
                            <i class="far fa-calendar text-gecu-blue"></i>
                        </div>
                        <p class="text-xs font-medium text-gray-500 uppercase tracking-wide">Date & Time</p>
                    </div>
                    <p class="text-base font-semibold text-gray-900 ml-11">
                        {{ transaction.created_at|date:"F d, Y, h:i A" }}
                    </p>
                </div>

                <!-- Transaction Type -->
                <div class="bg-gecu-light/50 rounded-xl p-4">
                    <div class="flex items-center mb-2">
                        <div class="w-8 h-8 rounded-lg bg-white flex items-center justify-center mr-3">
                            <i class="fas fa-tag text-gecu-blue"></i>
                        </div>
                        <p class="text-xs font-medium text-gray-500 uppercase tracking-wide">Type</p>
                    </div>
                    <p class="text-base font-semibold text-gray-900 ml-11">
                        {{ transaction.get_transaction_type_display }}
                    </p>
                </div>

                <!-- From Account -->
                <div class="bg-gecu-light/50 rounded-xl p-4">
                    <div class="flex items-center mb-2">
                        <div class="w-8 h-8 rounded-lg bg-white flex items-center justify-center mr-3">
                            <i class="far fa-credit-card text-gecu-blue"></i>
                        </div>
                        <p class="text-xs font-medium text-gray-500 uppercase tracking-wide">From Account</p>
                    </div>
                    <p class="text-base font-semibold text-gray-900 ml-11">
                        {{ transaction.wallet.get_account_type_display }}
                    </p>
                    <p class="text-sm text-gray-600 ml-11 font-mono">
                        ••••{{ transaction.wallet.account_number|slice:"-4:" }}
                    </p>
                </div>

                <!-- To/From Account (if exists) -->
                {% if transaction.related_wallet %}
                <div class="bg-gecu-light/50 rounded-xl p-4">
                    <div class="flex items-center mb-2">
                        <div class="w-8 h-8 rounded-lg bg-white flex items-center justify-center mr-3">
                            <i class="fas fa-exchange-alt text-gecu-blue"></i>
                        </div>
                        <p class="text-xs font-medium text-gray-500 uppercase tracking-wide">
                            {% if is_credit %}From{% else %}To{% endif %} Account
                        </p>
                    </div>
                    <p class="text-base font-semibold text-gray-900 ml-11">
                        {{ transaction.related_wallet.get_account_type_display }}
                    </p>
                    <p class="text-sm text-gray-600 ml-11 font-mono">
                        ••••{{ transaction.related_wallet.account_number|slice:"-4:" }}
                    </p>
                    {% if other_party %}
                    <p class="text-sm text-gray-500 ml-11 mt-1 italic">{{ other_party }}</p>
                    {% endif %}
                </div>
                {% endif %}

                <!-- Deposit Method (if exists) -->
                {% if transaction.deposit_method %}
                <div class="bg-gecu-light/50 rounded-xl p-4">
                    <div class="flex items-center mb-2">
                        <div class="w-8 h-8 rounded-lg bg-white flex items-center justify-center mr-3">
                            <i class="fas fa-money-check text-gecu-blue"></i>
                        </div>
                        <p class="text-xs font-medium text-gray-500 uppercase tracking-wide">Method</p>
                    </div>
                    <p class="text-base font-semibold text-gray-900 ml-11">
                        {{ transaction.deposit_method }}
                    </p>
                </div>
                {% endif %}

                <!-- Reference Number -->
                <div class="bg-gecu-light/50 rounded-xl p-4 md:col-span-2">
                    <div class="flex items-center mb-2">
                        <div class="w-8 h-8 rounded-lg bg-white flex items-center justify-center mr-3">
                            <i class="fas fa-hashtag text-gecu-blue"></i>
                        </div>
                        <p class="text-xs font-medium text-gray-500 uppercase tracking-wide">Reference Number</p>
                    </div>
                    <p class="text-base font-semibold text-gray-900 ml-11 font-mono">
                        {{ transaction.reference_code }}
                    </p>
                </div>

                <!-- Description (if exists) -->
                {% if transaction.description %}
                <div class="bg-gecu-light/50 rounded-xl p-4 md:col-span-2">
                    <div class="flex items-center mb-2">
                        <div class="w-8 h-8 rounded-lg bg-white flex items-center justify-center mr-3">
                            <i class="fas fa-file-alt text-gecu-blue"></i>
                        </div>
                        <p class="text-xs font-medium text-gray-500 uppercase tracking-wide">Description</p>
                    </div>
                    <p class="text-base text-gray-900 ml-11">
                        {{ transaction.description }}
                    </p>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Action Buttons (Commented out as per original) -->
        <!--<div class="border-t border-gray-200 px-6 py-4 bg-gray-50/50 flex flex-col sm:flex-row items-center justify-end gap-3">
            <button type="button" 
                    @click="window.print()" 
                    class="w-full sm:w-auto inline-flex items-center justify-center px-5 py-2.5 rounded-xl border-2 border-gecu-blue text-gecu-blue font-semibold hover:bg-gecu-blue hover:text-white transition-all duration-200">
                <i class="fas fa-print mr-2"></i> Print Receipt
            </button>
            <a href="#" 
               download="transaction-{{ transaction.reference_code }}.pdf" 
               class="w-full sm:w-auto inline-flex items-center justify-center px-5 py-2.5 rounded-xl bg-gradient-to-r from-gecu-navy to-gecu-blue text-white font-semibold hover:shadow-xl transform hover:scale-105 transition-all duration-200">
                <i class="fas fa-download mr-2"></i> Download PDF
            </a>
        </div>-->
    </div>

    <!-- Help Card -->
    <div class="glass-effect rounded-2xl p-6 border-l-4 border-gecu-blue">
        <div class="flex items-start">
            <div class="flex-shrink-0">
                <div class="w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center">
                    <i class="fas fa-info-circle text-gecu-blue"></i>
                </div>
            </div>
            <div class="ml-4">
                <h4 class="text-sm font-semibold text-gray-900 mb-1">Need Help?</h4>
                <p class="text-sm text-gray-600">
                    If you have questions about this transaction, please contact our support team at 
                    <a href="mailto:support@grandelitecreditunion.com" class="text-gecu-blue hover:underline font-medium">
                        support@grandelitecreditunion.com
                    </a>
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %}